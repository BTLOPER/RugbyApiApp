# IsDataComplete Quick Reference

## What It Does

Tracks which data has been fully fetched from the API to avoid redundant calls.

## Quick Start

### Check What's Incomplete
```csharp
var incompleteTeams = await dataService.GetIncompleteTeamsAsync();
var incompleteLeagues = await dataService.GetIncompleteLeaguesAsync();
var incompletePlayers = await dataService.GetIncompletePlayersAsync();
```

### See Completion Status
```csharp
var stats = await dataService.GetCompletionStatsAsync();
Console.WriteLine(stats);

// Output:
// === Data Completion Statistics ===
// Seasons:  5/5 (100.0%)
// Leagues:  25/25 (100.0%)
// Teams:    38/38 (100.0%)
// Players:  450/450 (100.0%)
// Matches:  321/321 (100.0%)
```

### Mark Complete After Fetch
```csharp
// After fetching players for a team
await dataService.MarkTeamDataCompleteAsync(teamId);
```

## Data Hierarchy

```
? Season (complete when fetched)
? League (complete when fetched)
? Team (incomplete until ALL players fetched)
? Player (complete when fetched)
? Match (complete when fetched)
```

## API Usage Pattern

### Efficient Fetching
```csharp
// 1. Check what needs fetching
var incompleteTeams = await dataService.GetIncompleteTeamsAsync();

// 2. Only fetch missing data
foreach (var team in incompleteTeams)
{
    var players = await apiClient.GetTeamPlayersAsync(team.Id);
    // Store players...
    await dataService.MarkTeamDataCompleteAsync(team.Id);
}

// 3. On next run, nothing to fetch!
var incompleteTeams2 = await dataService.GetIncompleteTeamsAsync();
// Count = 0, no API calls needed
```

## Completion Percentages

```csharp
var stats = await dataService.GetCompletionStatsAsync();

// Access individual percentages
double seasonPercent = stats.SeasonCompletionPercent;      // 0-100
double leaguePercent = stats.LeagueCompletionPercent;      // 0-100
double teamPercent = stats.TeamCompletionPercent;          // 0-100
double playerPercent = stats.PlayerCompletionPercent;      // 0-100
double matchPercent = stats.MatchCompletionPercent;        // 0-100
```

## Common Tasks

### Skip API Call if Data Complete
```csharp
var incompleteSeasons = await dataService.GetIncompleteSeasonAsync();
if (incompleteSeasons.Count > 0)
{
    var seasons = await apiClient.GetSeasonsAsync();
    // Process...
}
else
{
    Console.WriteLine("Seasons already fetched!");
}
```

### Fetch Only Missing Data
```csharp
var teams = await dataService.GetIncompleteTeamsAsync();
foreach (var team in teams)
{
    var players = await apiClient.GetTeamPlayersAsync(team.Id);
    // Store players...
    await dataService.MarkTeamDataCompleteAsync(team.Id);
}
```

### Check Individual Item Status
```csharp
var team = await dataService.GetTeamAsync(teamId);
if (team.IsDataComplete)
{
    Console.WriteLine("All players for this team are fetched");
}
else
{
    Console.WriteLine("Need to fetch players for this team");
}
```

## Database Columns

All models have:
```csharp
public bool IsDataComplete { get; set; }
```

Default values:
- **Seasons**: `true` (after fetch)
- **Leagues**: `true` (after fetch)
- **Teams**: `false` ? `true` (when all players fetched)
- **Players**: `true` (after fetch)
- **Matches**: `true` (after fetch)

## API Call Savings

| Scenario | Without IsDataComplete | With IsDataComplete |
|----------|----------------------|-------------------|
| 1st run with 30 teams | 60 API calls | 60 API calls |
| 2nd run | 60 API calls (wasted!) | 0 API calls ? |
| 3rd run | 60 API calls (wasted!) | 0 API calls ? |
| Monthly | 1,800 calls | 60 calls ? **96.7% savings** |

## Implementation Pattern

```csharp
// Step 1: Check for incomplete data
var incomplete = await dataService.GetIncompleteTeamsAsync();

// Step 2: Only fetch if needed
if (incomplete.Count > 0)
{
    foreach (var team in incomplete)
    {
        var data = await apiClient.FetchDataAsync(team.Id);
        await dataService.StoreDataAsync(data);
    }
}

// Step 3: Mark complete
await dataService.MarkTeamDataCompleteAsync(teamId);

// Step 4: Monitor progress
var stats = await dataService.GetCompletionStatsAsync();
Console.WriteLine(stats);
```

## Error Handling

If fetch fails, item stays incomplete:
```csharp
try
{
    var players = await apiClient.GetTeamPlayersAsync(team.Id);
    await dataService.StorePlayersAsync(players);
    await dataService.MarkTeamDataCompleteAsync(team.Id); // Only if successful
}
catch (Exception ex)
{
    // Team remains incomplete
    // Will retry on next run
}
```

## Reset If Needed

```csharp
// Clear everything and start over
await dataService.ClearAllDataAsync();

// Or manually reset a team
var team = await dataService.GetTeamAsync(teamId);
team.IsDataComplete = false;
// Save to database...
```

## Monitoring

```csharp
// Real-time progress
var stats = await dataService.GetCompletionStatsAsync();

Console.WriteLine($"Teams: {stats.CompleteTeams}/{stats.TotalTeams}");
Console.WriteLine($"Progress: {stats.TeamCompletionPercent:F1}%");

// Check specific types
if (stats.TeamCompletionPercent == 100)
{
    Console.WriteLine("? All teams complete!");
}
```

## See Also

- Full guide: `ISDATACOMPLETE_GUIDE.md`
- Models: `Models/` directory
- Data service: `Services/DataService.cs`
